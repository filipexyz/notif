# nats-server.conf — notif.sh NATS server configuration
#
# This is the config for the NATS server that notif connects to.
# notif is a NATS CLIENT (not embedded server), so all transport
# config (leafnode, subject mapping) lives here.
#
# Usage:
#   nats-server -c nats-server.conf
#
# Or with Docker:
#   docker run -v ./nats-server.conf:/etc/nats/nats-server.conf nats:2.10-alpine \
#     -c /etc/nats/nats-server.conf
#
# Hot reload (no restart needed):
#   nats-server --signal reload

# --- Core ---
listen: 0.0.0.0:4222
http_port: 8222

# --- JetStream ---
jetstream {
  store_dir: /data
  max_mem: 256MB
  max_file: 1GB
}

# --- Leafnode ---
# Leafnode connects this NATS server to external NATS servers.
# Subjects flow bidirectionally. No code needed — pure config.
#
# To enable: uncomment the leafnodes block and add your remotes.
#
# leafnodes {
#   remotes [
#     {
#       # External NATS server (e.g., Omni)
#       url: "nats-leaf://omni-nats.example.com:7422"
#
#       # Optional: credentials
#       # credentials: "/etc/nats/omni.creds"
#       # account: "OMNI"
#
#       # Optional: TLS
#       # tls {
#       #   cert_file: "/etc/nats/cert.pem"
#       #   key_file: "/etc/nats/key.pem"
#       #   ca_file: "/etc/nats/ca.pem"
#       # }
#     }
#   ]
# }

# --- Subject Mapping ---
# Maps external NATS subjects to notif's internal namespace and vice versa.
# notif uses: events.{org_id}.{project_id}.{topic}
# External systems use their own subject schemes.
#
# Example: Omni uses flat subjects like "message.received.whatsapp.wa-001"
# and we want them to appear as "events.org_default.default.omni.inbound.whatsapp.wa-001"
#
# NATS subject mapping transforms subjects at the server level.
# Wildcards: * = one token, > = one or more tokens
#
# mappings = {
#   # Inbound: external -> notif
#   # "message.received.>" maps to "events.org_default.default.omni.inbound.>"
#   "message.received.>" : "events.org_default.default.omni.inbound.>"
#
#   # Outbound: notif -> external
#   # "events.org_default.default.omni.outbound.>" maps to "message.send.>"
#   "events.org_default.default.omni.outbound.>" : "message.send.>"
# }

# --- Logging ---
# debug: false
# trace: false
# logtime: true
# log_file: "/data/nats-server.log"
