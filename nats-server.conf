# NATS Server Configuration for notif.sh
# Multi-account via nats-resolver full (programmatic JWT push)
#
# IMPORTANT: Replace the operator and system_account values with your actual keys.
# Generate them with: go run scripts/genkey.go
#
# Environment variables:
#   OPERATOR_PUBLIC_KEY  - Operator public key (starts with O)
#   SYSTEM_ACCOUNT_KEY   - System account public key (starts with A)

server_name: notifd

# JetStream configuration
jetstream {
    store_dir: /data/nats/jetstream
    max_mem: 1G
    max_file: 100G
}

# Resolver configuration: nats-resolver full
# JWTs are pushed programmatically via $SYS.REQ.CLAIMS.UPDATE
# No nsc needed — notifd generates and pushes JWTs at runtime
resolver {
    type: full
    dir: /data/nats/jwt
    allow_delete: true
    interval: "2m"
}

# Operator public key — set from OPERATOR_PUBLIC_KEY env or replace inline
operator: $OPERATOR_PUBLIC_KEY

# System account — used by notifd for $SYS monitoring and claims management
system_account: $SYSTEM_ACCOUNT_KEY

# Resolver preload: bootstrap system account JWT
# This is populated by notifd on first boot
resolver_preload {}

# Logging
debug: false
trace: false
logtime: true

# Networking
listen: 0.0.0.0:4222
http_port: 8222

# Max payload per message (1MB)
max_payload: 1048576

# Max connections
max_connections: 65536

# --- Leafnode (optional) ---
# Connects to external NATS servers for federation.
# Uncomment and configure for your deployment.
#
# leafnodes {
#   remotes [
#     {
#       url: "nats-leaf://remote-nats.example.com:7422"
#       # credentials: "/etc/nats/remote.creds"
#     }
#   ]
# }
